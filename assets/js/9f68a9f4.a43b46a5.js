/*! For license information please see 9f68a9f4.a43b46a5.js.LICENSE.txt */
(self.webpackChunkblog=self.webpackChunkblog||[]).push([[811],{7583:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/dependency-hell.d75936c.490.png 490w",images:[{path:n.p+"assets/ideal-img/dependency-hell.d75936c.490.png",width:490,height:467}],src:n.p+"assets/ideal-img/dependency-hell.d75936c.490.png",toString:function(){return n.p+"assets/ideal-img/dependency-hell.d75936c.490.png"},placeholder:void 0,width:490,height:467},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVQYlQXBT0hTcQDA8d/BlELd2iK2uUTN4dx429623NpykQSCh8YabnO6txYiajxaJbRCO8ylFloKdZhehtIfaAe9dFgQiBW1IMRRYhcv0q1LdP/6+YjHWzUW3v8mnnvEYFal8G6bwtsKS+UKq5Uqb74csPHpAPH6Y5VSpcq1XB5rfAhbNIE1FsOeTDC28Jzyzh6lD1WEWlghO/eCfvUuUiqNJ55EGh6i99Y40akHzCyvMb1cRDgCQZwXA3R5vZx3u+nyXsDi9tAhy0g+P+5LIaRgCPH1xy6fv32n9nOf/JMlznXbMFra0JuNNJxspu5EPTq9AbF3+JdfR//Z//OPSHoMrdnIaYOOprOnaLFoMXU2odFrELHMJLcfFpjKP+Pq4CieviiNegtnTGb8IR92l0S3bEdMqneYnXvK/OJLJu7P47kcpbVdpqfnCpHrMWxOGVNHO6K8+Yr1jSJq9h7J4RQ3MxkURSGlKIwoNxgIh3G4XBwDWxTAxgRIFrkAAAAASUVORK5CYII="}},918:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/pypi-test.1ff59b6.640.png 640w",images:[{path:n.p+"assets/ideal-img/pypi-test.1ff59b6.640.png",width:640,height:406}],src:n.p+"assets/ideal-img/pypi-test.1ff59b6.640.png",toString:function(){return n.p+"assets/ideal-img/pypi-test.1ff59b6.640.png"},placeholder:void 0,width:640,height:406},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQYlU3Kz0oCURzF8d+mVfSQDe40rWfoAaJFOpDaJrKUCkaiTXshK6GFYKEhLVpp4+3OzP3T9A2HFi0+HDjnSK0dsncSstsO2Wk2KB/XqTQbf+pUWwdUW0eIBF22KpdslntI6RwJOkhwhmxfIKUuG7VDpHSK9B+nXA3GRMMXovsJ/eGE29GUm9GM6GnGfvRMZ/CKQM71w5y78QffmQafse7g5x8Q4zzLlSazjnilWH7GhUWsiJVGJynWe8R5zyL+QqeGNE3JsgxrLdb5Qp7nBVkPb/N3dJIUR6VUkdYarDEYY3DO8QuW0uqY5T2TogAAAABJRU5ErkJggg=="}},7396:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>y,contentTitle:()=>h,default:()=>c,frontMatter:()=>l,metadata:()=>m,toc:()=>u});var a=n(7462),o=(n(7294),n(4137)),i=n(1722),r=(n(8839),n(5944)),s=n(4259),p=n(425);const l={title:"Python environments with pyenv and poetry",slug:"python-environments-with-pyenv-and-poetry",hide_table_of_contents:!1,image:"https://haruiz.github.io/img/2022-08-07-Python-environments-with-pyenv-and-poetry-og_image.png",description:"If you have been using Python for a while or just started, you may have already noticed that handling different python-installations and dependencies(packages) can be a nightmare! So, having tools that enable us to isolate and manage our project's dependencies is highly convenient. In this post, I will show you how to use pyenv and poetry to create your code environments.",authors:["haruiz"],tags:["python","data-science"]},h=void 0,m={permalink:"/blog/python-environments-with-pyenv-and-poetry",source:"@site/blog/2022-08-07-Python-environments-with-pyenv-and-poetry/index.md",title:"Python environments with pyenv and poetry",description:"If you have been using Python for a while or just started, you may have already noticed that handling different python-installations and dependencies(packages) can be a nightmare! So, having tools that enable us to isolate and manage our project's dependencies is highly convenient. In this post, I will show you how to use pyenv and poetry to create your code environments.",date:"2022-08-07T00:00:00.000Z",formattedDate:"August 7, 2022",tags:[{label:"python",permalink:"/blog/tags/python"},{label:"data-science",permalink:"/blog/tags/data-science"}],readingTime:17.67,hasTruncateMarker:!0,authors:[{name:"Henry Ruiz",title:"Blog Author",url:"https://github.com/haruiz",imageURL:"https://github.com/haruiz.png",key:"haruiz"}],frontMatter:{title:"Python environments with pyenv and poetry",slug:"python-environments-with-pyenv-and-poetry",hide_table_of_contents:!1,image:"https://haruiz.github.io/img/2022-08-07-Python-environments-with-pyenv-and-poetry-og_image.png",description:"If you have been using Python for a while or just started, you may have already noticed that handling different python-installations and dependencies(packages) can be a nightmare! So, having tools that enable us to isolate and manage our project's dependencies is highly convenient. In this post, I will show you how to use pyenv and poetry to create your code environments.",authors:["haruiz"],tags:["python","data-science"]},prevItem:{title:"Python for Data Science - Part 1",permalink:"/blog/python-for-data-science-part-1"}},y={authorsImageUrls:[void 0]},u=[{value:"Why Python?",id:"why-python",level:3},{value:"Python Dependency hell",id:"python-dependency-hell",level:3},{value:"Virtual environments to the rescue!",id:"virtual-environments-to-the-rescue",level:3},{value:"Pyenv",id:"pyenv",level:3},{value:"Poetry",id:"poetry",level:3},{value:"Hands-on tutorial",id:"hands-on-tutorial",level:3}],d={toc:u};function c(e){let{components:t,...l}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"why-python"},"Why Python?"),(0,o.kt)("p",null,"According to the ",(0,o.kt)("a",{parentName:"p",href:"https://survey.stackoverflow.co/2022/#technology-most-loved-dreaded-and-wanted"},(0,o.kt)("strong",{parentName:"a"},"2022 stack overflow developer survey")),", Python is one of the most widely used programming languages today. Of 71,467 responses, 68% of developers expressed that they love the language and are planning to continue working with Python, and approximately 12.000 of those who haven't got the chance to use it have expressed their interest in starting developing with it. Its popularity is mainly due to its simplicity in syntax, expressiveness, and versatility. We can use Python to create any kind of software, from web applications to scientific computing."),(0,o.kt)("p",null,"Python also has ",(0,o.kt)("a",{parentName:"p",href:"https://pypi.org/"},(0,o.kt)("strong",{parentName:"a"},"PyPI package index")),",a python package repository, where you can find many useful packages (Tensorflow, pandas, NumPy, etc.), which facilitates and speeds up your project's development. In PyPI, you can also publish your packages and share them with the community. The ecosystem keeps growing fast, and big companies like Google, Facebook, and IBM contribute by adding new packages. "),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},'The Python Package Index, abbreviated as PyPI (/\u02ccpa\u026api\u02c8a\u026a/) and also known as the Cheese Shop (a reference to the Monty Python\'s Flying Circus sketch "Cheese Shop"), is the official third-party software repository for Python. It is analogous to the CPAN repository for Perl and to the CRAN repository for R.',(0,o.kt)("a",{href:"#wikipedia:1"},"[1]"))),(0,o.kt)("h3",{id:"python-dependency-hell"},"Python Dependency hell"),(0,o.kt)("p",null,"Well, it sounds like Python is amazing! However, if you have been using Python for a while, you may have already noticed that handling different python-installations and dependencies(packages) can be a nightmare! An issue commonly known as dependency hell, which is a term associated with the frustration arising from problems managing our project's dependencies. "),(0,o.kt)("p",null,"Dependency hell in Python often happens because pip does not have a dependency resolver and because all dependencies are shared across projects. So, other projects could be affected when a given dependency may need to be updated or uninstalled. "),(0,o.kt)("p",null,"On top of it, since Python doesn't distinguish between different versions of the same library in the ",(0,o.kt)("inlineCode",{parentName:"p"},"/site-packages")," directory, this leads to many conflicts when you have two projects requiring different versions of the same library or the global installation doesn't match."),(0,o.kt)("p",null,"Thus, having tools that enable us to isolate and manage our project's dependencies is highly convenient. In this post, I will show you how to use pyenv and poetry to create your code environments."),(0,o.kt)("div",{style:{textAlign:"center"}},(0,o.kt)(r.Z,{img:n(7583),alt:"Dependency hell",mdxType:"Image"})),(0,o.kt)("h3",{id:"virtual-environments-to-the-rescue"},"Virtual environments to the rescue!"),(0,o.kt)("p",null,"A Python virtual environment is a separate folder where only your project's dependencies(packages) are located. Each virtual environment has its own Python binary (which matches the version of the binary that was used to create this environment) and its own independent set of installed Python packages in its site directories. That is a very convenient way to prevent ",(0,o.kt)("inlineCode",{parentName:"p"},"Dependency Hell.")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Python virtual environment allows multiple versions of Python to coexist in the same machine, so you can test your application using different Python versions. It also keeps your project's dependencies isolated, so they don't interfere with the dependencies of others projects.")),(0,o.kt)("p",null,"There are different tools out there that can be used to create Python virtual environments. In this post, I will show you how to use pyenv and poetry. However, you can also try other tools, such as ",(0,o.kt)("a",{parentName:"p",href:"https://virtualenv.pypa.io/en/latest/"},"virtualenv")," or anaconda, and based on your experience, you can choose that one you feel most comfortable with.\nthe video below will provide you with more information about these kinds of tools."),(0,o.kt)("center",null,(0,o.kt)("iframe",{width:"100%",height:"400",src:"https://www.youtube.com/embed/3J02sec99RM",f:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,o.kt)("h3",{id:"pyenv"},"Pyenv"),(0,o.kt)("p",null,"pyenv is a command line tool which allows you to install and run multiple versions of Python in the same machine. For those who come from a javascript background, pyenv is a very similar tool to nvm."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Setup & get started with pyenv")),(0,o.kt)("p",null,"You can follow the steps below for installing ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv")," on macOS or check the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/pyenv/pyenv"},"documentation")," for alternative installation methods. "),(0,o.kt)(i.Z,{lines:[{type:"input",value:"curl https://pyenv.run | bash",comment:"Install pyenv"},{type:"output",value:"Installing pyenv..."},{type:"output",value:"Installation complete!"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"After having installed pyenv, you can then install any python version running the command ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv install <version>"),"."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"pyenv install 3.9.0",comment:"Install python 3.9.0 in my machine"},{type:"output",value:"Downloading Python-3.9.0.tar.xz..."},{type:"output",value:"-> https://www.python.org/ftp/python/3.7.6/Python-3.7.6.tar.xz",delay:1e3},{type:"progress"},{type:"output",value:"Installed Python-3.9.0 to /Users/haruiz/.pyenv/versions/3.9.0"}],mdxType:"TermynalReact"}),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"if you are not sure about which versions are available to be installed in your machine, you can run the command ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv install --list"),".")),(0,o.kt)("p",null,"You can run the command ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv versions")," to check which Python versions have been installed."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"pyenv versions",comment:"Check which versions of Python are installed"},{type:"output",value:"system"},{type:"output",value:"* 3.10.0 (set by /Users/haruiz/.pyenv/version)"},{type:"output",value:"3.9.0"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"To set the default version of Python to be used, you can run the command ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv global <version>"),". This version will be used when you run ",(0,o.kt)("inlineCode",{parentName:"p"},"python")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"python3")," in your terminal."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"pyenv global 3.10.0",comment:"Set python 3.10.0 as the default version"},{type:"input",value:"python --version",comment:"Check the version of python after setting it"},{type:"output",value:"Python 3.9.0"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"Alternatively to the ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv global")," command, Sometimes you want to set a specific version of Python to be used within a specific folder. You can create a ",(0,o.kt)("inlineCode",{parentName:"p"},".python-version")," file in the folder and set the version you want to use,  or by running the command ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv local <version>"),". pyenv will then use this version when you run ",(0,o.kt)("inlineCode",{parentName:"p"},"python")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"python3")," in the folder."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"mkdir myproject",comment:"Create a folder called myproject"},{type:"input",value:"cd myproject",comment:"Change directory to myproject"},{type:"input",value:"pwd",comment:"Check the current directory after the cd command"},{type:"output",value:"/Users/haruiz/myproject"},{type:"input",value:"pyenv local 3.9.0",comment:"Set python 3.9.0 as the default version in myproject"},{type:"input",value:"python --version",comment:"Check the version of python after setting it"},{type:"output",value:"Python 3.9.0"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"To make sure what python version is being used by pyenv, you can run the command ",(0,o.kt)("inlineCode",{parentName:"p"},"pyenv version"),"."),(0,o.kt)("h3",{id:"poetry"},"Poetry"),(0,o.kt)("p",null,"Poetry is a tool that allows you to manage your project's dependencies and facilitates the process of packaging for distribution. It resolves your project dependencies and makes sure that there are no conflicts between them."),(0,o.kt)("p",null,"Poetry integrates with the ",(0,o.kt)("a",{parentName:"p",href:"https://pypi.org/"},"PyPI")," package index to find and install your environment dependencies, and pyenv to set your project python runtime."),(0,o.kt)("p",null,"To install poetry we follow the steps below:"),(0,o.kt)(i.Z,{lines:[{type:"input",value:"curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python",comment:"Install poetry"},{type:"progress"},{type:"output",value:"Installation complete!"},{type:"input",value:'export PATH="$HOME/.poetry/bin:$PATH"',comment:"Add poetry to the PATH"},{type:"input",value:"poetry --version",comment:"Check the version of poetry after installing it"},{type:"output",value:"Poetry version 1.1.13"},{type:"input",value:"poetry help completions",comment:"Check the completions of poetry"},{type:"output",value:"poetry completions bash"},{type:"input",value:"poetry config virtualenvs.in-project true",comment:"Configure poetry to create virtual environments inside the project's root directory"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"If you were able to run the previous commands, we can then move forward with the rest of the tutorial."),(0,o.kt)("p",null,"To ask poetry to create a new project, we use the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry new <project name>"),".\nThis will create a new folder with the name ",(0,o.kt)("inlineCode",{parentName:"p"},"<project name>")," and a ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," folder inside it."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"poetry new myproject",comment:"Create a new project called myproject"},{type:"output",value:"Created package myproject in myproject"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"If you already have a project, and you want to use poetry to manage the dependencies, you can use the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry init"),". So, poetry will add the ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," file to your project."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"cd myproject",comment:"Change directory to myproject"},{type:"input",value:"poetry init",comment:"Initialize poetry in myproject"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"The main file of your poetry project is the ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," file. This file defines your project's dependencies(python packages) and holds the required metadata for packaging. Poetry updates this file every time a new python package is installed. By sharing this file with others, they can recreate your project environment and run your application. To do so, they will need to have poetry installed and run the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry install")," within the same folder where the ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," file is located."),(0,o.kt)("p",null,"Now we can start adding dependencies to our project. To do so, we use the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry add <package name>"),"."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"poetry add numpy pandas",comment:"Add numpy and pandas to the project, this command replaces the pip install command"},{type:"output",value:"Installed requests"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"Now our ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," file looks like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[tool.poetry]\nname = "myproject"\nversion = "0.1.0"\ndescription = ""\nauthors = ["Henry Ruiz  <henry.ruiz.tamu@gmail.com>"]\n\n[tool.poetry.dependencies]\npython = "^3.10"\nnumpy = "^1.23.1"\npandas = "^1.4.3"\n\n[tool.poetry.dev-dependencies]\npytest = "^5.2"\n\n[build-system]\nrequires = ["poetry-core>=1.0.0"]\nbuild-backend = "poetry.core.masonry.api"\n')),(0,o.kt)("p",null,"Lest review that file sections:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"[","tool.poetry","]",":")," This section contains informational metadata about our package, such as the package name, description, author details, etc. Most of the config values here are optional unless you're planning on publishing this project as an official PyPi package. "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"[","tool.poetry.dependencies","]",":")," This section defines the dependencies of your project. Here is where you define the python packages that your project requires to run. We can update this file manually if it is needed."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"[","tool.poetry.dev-dependencies","]",":")," This section defines the dev dependencies of your project. These dependencies are not required for your project to run, but they are useful for development."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"[","build-system","]",":")," This is rarely a section you'll need to touch unless you upgrade your version of Poetry.")),(0,o.kt)("p",null,"To see in a nicer format the dependencies of your project, you can use the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry show --tree"),". This command draws a graph of all of our dependencies as well as the dependencies of our dependencies."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"poetry show --tree",comment:"Show the dependencies of our project"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"If we are not sure at some point that we have the latest version of a dependency, we can tell poetry to check on our package repository if there is a new version by using \u201c\u2014 latest\u201d option"),(0,o.kt)(i.Z,{lines:[{type:"input",value:"poetry show --latest",comment:"Show the latest version of our dependencies"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"If we list our folder content, we will see that not only the ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," file is created, but also some other folders and files. So, let's take a look at the contents of the ",(0,o.kt)("inlineCode",{parentName:"p"},"myproject")," folder."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 .venv\n\u2502\xa0\xa0 \u251c\u2500\u2500 .gitignore\n\u2502\xa0\xa0 \u251c\u2500\u2500 bin\n\u2502\xa0\xa0 \u251c\u2500\u2500 lib\n\u2502\xa0\xa0 \u2514\u2500\u2500 pyvenv.cfg\n\u251c\u2500\u2500 README.rst\n\u251c\u2500\u2500 myproject\n\u2502\xa0\xa0 \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 poetry.lock\n\u251c\u2500\u2500 pyproject.toml\n\u2514\u2500\u2500 tests\n    \u251c\u2500\u2500 __init__.py\n    \u2514\u2500\u2500 test_myproject.py\n\n5 directories, 11 files\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"`",".venv","`"),": This folder is created by poetry when it creates a virtual environment.It isolates the project from the system environment and provides a clean environment for your project. It contains the Python interpreter and your projects dependencies. "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"poetry.lock"),": When Poetry finished installing the dependencies, it writes all of the packages and the exact versions of them to the poetry.lock file, locking the project to those specific versions. ")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"}," Notice that this folder structure is created only if the ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry new myproject")," was executed. When poetry is initialized within a folder that already exists ( using the ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry init")," command), only the ",(0,o.kt)("inlineCode",{parentName:"p"},"pryproject.toml")," and the .env folder are created.")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You should commit the poetry.lock file to your project repo so that all people working on the project are locked to the same versions of dependencies. For more info, check this link : ",(0,o.kt)("a",{parentName:"p",href:"https://python-poetry.org/docs/basic-usage/"},"Poetry basic usage"))),(0,o.kt)("p",null,"Building our project and publishing it is just running the ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry build")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry publish")," commands, so it is pretty intuitive. The publish command will submit our application to pip, so other developers can easily install it."),(0,o.kt)("h3",{id:"hands-on-tutorial"},"Hands-on tutorial"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Creating a python package using poetry")),(0,o.kt)("p",null,"In this section, you will learn how to create a simple python package named ",(0,o.kt)("inlineCode",{parentName:"p"},"style_image"),' with poetry. This simple python package takes two images, the style image, and the content image, and performs style transfer. "Style transfer is an optimization technique used to take two images\u2014a content image and a style reference image (such as an artwork by a famous painter)\u2014and blend them together, so the output image looks like the content image, but \u201cpainted\u201d in the style of the style reference image."',(0,o.kt)("a",{href:"#tensorflow-docs:1"},"[2]")),(0,o.kt)("p",null,"For our ",(0,o.kt)("inlineCode",{parentName:"p"},"style_image")," package we will use the ",(0,o.kt)("inlineCode",{parentName:"p"},"magenta/arbitrary-image-stylization-v1-256")," model available in TensorflowHub under-the-hood."),(0,o.kt)("p",null,"So, let's do it!!"),(0,o.kt)("p",null,"We will start by creating a new project called ",(0,o.kt)("inlineCode",{parentName:"p"},"style_image")," using the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry new style_image"),"."),(0,o.kt)(i.Z,{lines:[{type:"input",value:"pyenv version",comment:"Check the version of python that is being used by pyenv, it would be the python version that will be used by poetry"},{type:"input",value:"poetry new style_image",comment:"Create a new project called style_image"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Installing package dependencies")),(0,o.kt)("p",null,"Next we are going to install the dependencies of our project, so we run the commands:"),(0,o.kt)(i.Z,{lines:[{type:"input",value:"cd style_image",comment:"Move into the style_image folder where the `pyproject.toml` file is located"},{type:"input",value:'poetry add tensorflow-hub tensorflow numpy pillow validators "typer[all]"',comment:"Add the dependencies to the project",lineDelay:10},{type:"output",value:"Updating dependencies"},{type:"output",value:"Resolving dependencies..."},{type:"progress",progressPercent:50},{type:"output",value:"Solver Problem : \n \nThe current project's Python requirement (>=3.10,<4.0) \nis not compatible with \nsome of the required packages Python requirement..... \n\nFor tensorflow, a possible solution would be to set the 'python' property to \">=3.10,<3.11\"\n                    ",color:"red"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"We will see that there is an error trying to install tensorflow:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Creating virtualenv style-image in /Users/haruiz/temp/style_image/.venv\nUsing version ^0.12.0 for tensorflow-hub\nUsing version ^2.9.1 for tensorflow\nUsing version ^1.23.1 for numpy\nUsing version ^9.2.0 for Pillow\nUsing version ^0.20.0 for validators\nUsing version ^0.6.1 for typer\n\nUpdating dependencies\nResolving dependencies... (4.2s)\n\n  SolverProblemError\n\n  The current project's Python requirement (>=3.10,<4.0) is not compatible with some of the required packages Python requirement:\n    - tensorflow-io-gcs-filesystem requires Python >=3.7, <3.11, so it will not be satisfied for Python >=3.11,<4.0\n")),(0,o.kt)("p",null,'The great thing is that poetry generally provides information on how to fix them. For the error above, poetry suggests restricting the python property to ">=3.10,<3.11" in the pyproject.toml file. '),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'    For tensorflow-io-gcs-filesystem, a possible solution would be to set the `python` property to ">=3.10,<3.11"\n')),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Make sure you always check the output in the terminal.")),(0,o.kt)("p",null,"So the ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," file is now:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-toml",metastring:"showLineNumbers {9}",showLineNumbers:!0,"{9}":!0},'[tool.poetry]\nname = "style_image"\nversion = "0.1.0"\ndescription = ""\nauthors = ["Henry Ruiz  <henryruiz22@gmail.com>"]\nreadme = "README.md"\n\n[tool.poetry.dependencies]\npython = ">=3.10,<3.11"\n\n[tool.poetry.dev-dependencies]\npytest = "^5.2"\nblack = "^22.6.0"\n\n[tool.poetry.scripts]\nstyle_image = "style_image.main:app"\n\n[build-system]\nrequires = ["poetry-core>=1.0.0"]\nbuild-backend = "poetry.core.masonry.api"\n')),(0,o.kt)("p",null,"We can then try to install the dependencies again:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'poetry add tensorflow-hub tensorflow numpy pillow validators "typer[all]"\n')),(0,o.kt)("p",null,"After installing the dependencies, our ",(0,o.kt)("inlineCode",{parentName:"p"},"pyproject.toml")," file is now:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-toml",metastring:"showLineNumbers {9-15}",showLineNumbers:!0,"{9-15}":!0},'[tool.poetry]\nname = "style_image"\nversion = "0.1.0"\ndescription = ""\nauthors = ["Henry Ruiz  <henryruiz22@gmail.com>"]\nreadme = "README.md"\n\n[tool.poetry.dependencies]\npython = ">=3.10,<3.11"\ntensorflow-hub = "^0.12.0"\nnumpy = "^1.23.1"\nPillow = "^9.2.0"\ntensorflow = "^2.9.1"\nvalidators = "^0.20.0"\ntyper = {extras = ["all"], version = "^0.6.1"}\n\n[tool.poetry.dev-dependencies]\npytest = "^5.2"\nblack = "^22.6.0"\n\n[tool.poetry.scripts]\nstyle_image = "style_image.main:app"\n\n[build-system]\nrequires = ["poetry-core>=1.0.0"]\nbuild-backend = "poetry.core.masonry.api"\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Coding our ",(0,o.kt)("inlineCode",{parentName:"strong"},"style_image")," package")),(0,o.kt)("p",null,"At this point, we are ready to start coding, let's create the folder structure below and replace the code in each .py file with the code on this repository ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/haruiz/style_image"},"https://github.com/haruiz/style_image"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 README.rst\n\u251c\u2500\u2500 data\n\u2502\xa0\xa0 \u2514\u2500\u2500 content_image.jpg\n\u251c\u2500\u2500 main.py\n\u251c\u2500\u2500 poetry.lock\n\u251c\u2500\u2500 pyproject.toml\n\u251c\u2500\u2500 style_image\n\u2502\xa0\xa0 \u251c\u2500\u2500 __init__.py\n\u2502\xa0\xa0 \u251c\u2500\u2500 core\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 __init__.py\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 style_image.py\n\u2502\xa0\xa0 \u251c\u2500\u2500 main.py\n\u2502\xa0\xa0 \u2514\u2500\u2500 util\n\u2502\xa0\xa0     \u251c\u2500\u2500 __init__.py\n\u2502\xa0\xa0     \u251c\u2500\u2500 __pycache__\n\u2502\xa0\xa0     \u2514\u2500\u2500 image_utils.py\n\u251c\u2500\u2500 stylized_image.png\n\u2514\u2500\u2500 tests\n    \u251c\u2500\u2500 __init__.py\n    \u2514\u2500\u2500 test_style_image.py\n")),(0,o.kt)("p",null,"Code :"),(0,o.kt)(s.Z,{mdxType:"Tabs"},(0,o.kt)(p.Z,{value:"main.py",label:"main.py",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:"showLineNumbers",showLineNumbers:!0},'from style_image import StyleImage\n\nif __name__ == "__main__":\n\n    content_image_path = "data/content_image.jpg"\n    style_image_path = "data/style_image.jpg"\n\n    stylized_image = (\n        StyleImage(style_image_path)\n        .transfer(content_image_path, output_image_size=800)\n        .save("stylized_image.jpg")\n    )\n'))),(0,o.kt)(p.Z,{value:"core/style_image.py",label:"core/style_image.py",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:"showLineNumbers",showLineNumbers:!0},'import tensorflow as tf\nimport tensorflow_hub as hub\n\nfrom style_image.util import ImageUtils\nfrom PIL import Image as PILImage\n\n\nclass StyleImage:\n    def __init__(self, style_image_path):\n        self._style_image_path = style_image_path\n        hub_handle = (\n            "https://tfhub.dev/google/magenta/arbitrary-image-stylization-v1-256/2"\n        )\n        self._hub_module = hub.load(hub_handle)\n\n    def transfer(\n        self, content_image_path, output_image_size=384, style_img_size=(256, 256)\n    ):\n        """\n        transfer the style of the style image to the content image\n        :param content_image_path: image path of the content image :\n        :param output_image_size: The content image size can be arbitrary.\n        :param style_img_size: The style prediction model was trained with image size 256 and it\'s the\n        recommended image size for the style image (though, other sizes work as\n        well but will lead to different results).\n        Recommended to keep it at 256.\n        :return:\n        """\n        content_img_size = (output_image_size, output_image_size)\n        # Load the content and style images.\n        content_image = ImageUtils.load_image(content_image_path, content_img_size)\n        style_image = ImageUtils.load_image(self._style_image_path, style_img_size)\n        # Stylize image.\n        stylized_image_tensor = self._hub_module(\n            tf.constant(content_image), tf.constant(style_image)\n        )[0]\n        stylized_image_arr = tf.image.convert_image_dtype(\n            stylized_image_tensor, tf.uint8\n        ).numpy()\n        stylized_image_arr = stylized_image_arr[0]  # Remove batch dimension.\n        stylized_image = PILImage.fromarray(stylized_image_arr)\n        return stylized_image\n'))),(0,o.kt)(p.Z,{value:"util/image_utils.py",label:"util/image_utils.py",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:"showLineNumbers",showLineNumbers:!0},'import functools\nimport tensorflow as tf\nimport os\nimport validators\n\n\nclass ImageUtils:\n    @staticmethod\n    def crop_center(image):\n        """Returns a cropped square image."""\n        shape = image.shape\n        new_shape = min(shape[1], shape[2])\n        offset_y = max(shape[1] - shape[2], 0) // 2\n        offset_x = max(shape[2] - shape[1], 0) // 2\n        image = tf.image.crop_to_bounding_box(\n            image, offset_y, offset_x, new_shape, new_shape\n        )\n        return image\n\n    @classmethod\n    @functools.lru_cache(maxsize=None)\n    def load_image(cls, image_path, image_size=(256, 256), \n                   preserve_aspect_ratio=True):\n        """Loads and preprocesses images."""\n        # Cache image file locally.\n        if validators.url(image_path):\n            image_path = tf.keras.utils.get_file(\n                os.path.basename(image_path)[-128:], image_path\n            )\n        # Load and convert to float32 numpy array, add batch dimension, and normalize to range [0, 1].\n        img = tf.io.decode_image(\n            tf.io.read_file(image_path), channels=3, dtype=tf.float32\n        )[tf.newaxis, ...]\n        img = cls.crop_center(img)\n        img = tf.image.resize(\n            img, image_size, preserve_aspect_ratio=preserve_aspect_ratio\n        )\n        return img\n\n'))),(0,o.kt)(p.Z,{value:"style_image/main.py",label:"style_image/main.py",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python",metastring:"showLineNumbers",showLineNumbers:!0},'from style_image import StyleImage\nimport typer\n\napp = typer.Typer()\n\n\ndef style_image_callback(value: str):\n    style_urls = dict(\n        kanagawa_great_wave="https://upload.wikimedia.org/wikipedia/commons/0/0a/The_Great_Wave_off_Kanagawa.jpg",\n        kandinsky_composition_7="https://upload.wikimedia.org/wikipedia/commons/b/b4/Vassily_Kandinsky%2C_1913_-_Composition_7.jpg",\n        hubble_pillars_of_creation="https://upload.wikimedia.org/wikipedia/commons/6/68/Pillars_of_creation_2014_HST_WFC3-UVIS_full-res_denoised.jpg",\n        van_gogh_starry_night="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg/1024px-Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg",\n        turner_nantes="https://upload.wikimedia.org/wikipedia/commons/b/b7/JMW_Turner_-_Nantes_from_the_Ile_Feydeau.jpg",\n        munch_scream="https://upload.wikimedia.org/wikipedia/commons/c/c5/Edvard_Munch%2C_1893%2C_The_Scream%2C_oil%2C_tempera_and_pastel_on_cardboard%2C_91_x_73_cm%2C_National_Gallery_of_Norway.jpg",\n        picasso_demoiselles_avignon="https://upload.wikimedia.org/wikipedia/en/4/4c/Les_Demoiselles_d%27Avignon.jpg",\n        picasso_violin="https://upload.wikimedia.org/wikipedia/en/3/3c/Pablo_Picasso%2C_1911-12%2C_Violon_%28Violin%29%2C_oil_on_canvas%2C_Kr%C3%B6ller-M%C3%BCller_Museum%2C_Otterlo%2C_Netherlands.jpg",\n        picasso_bottle_of_rum="https://upload.wikimedia.org/wikipedia/en/7/7f/Pablo_Picasso%2C_1911%2C_Still_Life_with_a_Bottle_of_Rum%2C_oil_on_canvas%2C_61.3_x_50.5_cm%2C_Metropolitan_Museum_of_Art%2C_New_York.jpg",\n        fire="https://upload.wikimedia.org/wikipedia/commons/3/36/Large_bonfire.jpg",\n        derkovits_woman_head="https://upload.wikimedia.org/wikipedia/commons/0/0d/Derkovits_Gyula_Woman_head_1922.jpg",\n        amadeo_style_life="https://upload.wikimedia.org/wikipedia/commons/8/8e/Untitled_%28Still_life%29_%281913%29_-_Amadeo_Souza-Cardoso_%281887-1918%29_%2817385824283%29.jpg",\n        derkovtis_talig="https://upload.wikimedia.org/wikipedia/commons/3/37/Derkovits_Gyula_Talig%C3%A1s_1920.jpg",\n        amadeo_cardoso="https://upload.wikimedia.org/wikipedia/commons/7/7d/Amadeo_de_Souza-Cardoso%2C_1915_-_Landscape_with_black_figure.jpg",\n    )\n    if value in style_urls:\n        return style_urls[value]\n    return value\n\n\n@app.command()\ndef main(\n    style_image: str = typer.Option(\n        ..., "--style_image", "-s", callback=style_image_callback\n    ),\n    content_image: str = typer.Option(..., "--content_image", "-c"),\n    output_image_size: int = typer.Option(384, "--output_image_size", "-sz"),\n    output_image_path: str = typer.Option("stylized_image.png", "--output_image_path", "-o"),\n):\n    style_image = StyleImage(style_image)\n    stylized_image = style_image.transfer(content_image, output_image_size=output_image_size)\n    stylized_image.save(output_image_path)\n\n')))),(0,o.kt)("admonition",{title:"running your scripts using the virtual environment",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Notice that if you want to execute the ",(0,o.kt)("inlineCode",{parentName:"p"},"main.py")," file or any other file/script using the python environment you just created, you need to run the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry run python main.py.")," So, poetry knows that you are running the ",(0,o.kt)("inlineCode",{parentName:"p"},"main.py")," file with the python environment created for the ",(0,o.kt)("inlineCode",{parentName:"p"},"style_image")," package.\nIf you feel more comfortable running ",(0,o.kt)("inlineCode",{parentName:"p"},"python main.py,")," instead of running ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry run ...")," you can permanently activate the environment running the command ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry shell."),". So it will be activated for all the commands you run.")),(0,o.kt)("p",null,"Poetry and pyenv are integrated with ",(0,o.kt)("inlineCode",{parentName:"p"},"visual studio")," code and ",(0,o.kt)("inlineCode",{parentName:"p"},"Pycharm"),". In fact, they will automatically recognize the python environment created by poetry."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Publishing our package to PyPi")),(0,o.kt)("p",null,"Publishing our package in Pypi should be straightforward. We just run the ",(0,o.kt)("inlineCode",{parentName:"p"},"poetry publish")," command. Since this is just a demo, we are going to publish our package to the pypi test repository ",(0,o.kt)("inlineCode",{parentName:"p"},"https://test.pypi.org/.")," However, the steps should be the same in production ",(0,o.kt)("inlineCode",{parentName:"p"},"https://pypi.org/.")),(0,o.kt)(i.Z,{lines:[{type:"input",value:"poetry build",comment:"build package"},{type:"input",value:"poetry config repositories.testpypi https://test.pypi.org/legacy/",comment:"add repository"},{type:"input",value:"poetry config repositories",comment:"list repositories"},{type:"output",value:"{'testpypi': {'url': 'https://test.pypi.org/'}}",color:"gray"},{type:"input",value:"poetry publish -r testpypi",comment:"publish package to testpypi repository"},{type:"prompt",value:"username : haruiz"},{type:"prompt",value:"password"},{type:"output",value:"Publishing style_image (0.1.0) to testpypi..",color:"green"}],mdxType:"TermynalReact"}),(0,o.kt)("p",null,"If the ",(0,o.kt)("inlineCode",{parentName:"p"},"publish")," command is successful, you will be able to find the package in the testpypi repository."),(0,o.kt)("div",{style:{textAlign:"center"}},(0,o.kt)(r.Z,{img:n(918),alt:"Dependency hell",mdxType:"Image"})),(0,o.kt)("p",null,"That is all!! We are done!!. You can check the links below for more information about poetry. "),(0,o.kt)("p",null,"Thanks for your support and don't forget to share,"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Some useful resources")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://python-poetry.org/"},"Poetry Documentation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/pyenv/pyenv"},"Pyenv Documentation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=QX_Nhu1zhlg&ab_channel=PyGotham2019"},"Great talk about poetry")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://hackersandslackers.com/python-poetry-package-manager/"},"Package Python Projects the Proper Way with Poetry")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://medium.com/analytics-vidhya/poetry-finally-an-all-in-one-tool-to-manage-python-packages-3c4d2538e828"},"Poetry: Finally an all-in-one tool to manage Python packages")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://towardsdatascience.com/packages-part-2-how-to-publish-test-your-package-on-pypi-with-poetry-9fc7295df1a5"},"Making Python Packages Part 2: How to Publish & Test Your Package on PyPI with Poetry")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://medium.com/packagr/publishing-to-a-private-python-repository-with-poetry-23b660484471"},"Publishing to a private Python repository with Poetry")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://serpapi.com/blog/python-virtual-environments-using-virtualenv-and-poetry/"},"Python Virtual Environments tutorial using Virtualenv and Poetry")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://medium.com/knerd/the-nine-circles-of-python-dependency-hell-481d53e3e025"},"The Nine Circles of Python Dependency Hell")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://blog.jayway.com/2019/12/28/pyenv-poetry-saviours-in-the-python-chaos/"},"Get started with pyenv & poetry. Saviours in the python chaos!"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"References")),(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{id:"wikipedia:1",href:"https://en.wikipedia.org/wiki/Python_Package_Index",target:"_blank"},"[1] Python Package Index")),(0,o.kt)("li",null,(0,o.kt)("a",{id:"tensorflow-docs:1",href:"https://www.tensorflow.org/tutorials/generative/style_transfer",target:"_blank"},"[2] Neural style transfer"))))}c.isMDXComponent=!0},1722:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var a=n(7462),o=n(7294),i=n(748),r=n(4259),s=n(425),p=n(5934),l=n(9319);function h(e){const t=(0,o.useRef)(null),{lines:h,...m}=e;return o.createElement(i.Z,{fallback:o.createElement("div",null,"Loading...")},(()=>{const i=(0,p.Z)(),y=n(7964);(0,o.useEffect)((()=>{const n=new y(t.current,{lineData:e.lines}),a=new IntersectionObserver((e=>{let[t]=e;t.isIntersecting&&(n.isRunning||n.start())}));return a.observe(t.current),{unmount:()=>{a.unobserve(t.current)}}}),[t]);const u=h.filter((e=>"input"===e.type)).map((e=>"comment"in e?"# "+e.comment+"\n"+e.value:e.value)).join("\n\n");return o.createElement(r.Z,{groupId:i},o.createElement(s.Z,{value:"bash",label:"Bash"},o.createElement(l.Z,{language:"bash",showLineNumbers:!1},u)),o.createElement(s.Z,{value:"terminal",label:"terminal"},o.createElement("div",(0,a.Z)({ref:t},m,{style:{marginBottom:20,marginTop:20}}))))}))}},7964:e=>{"use strict";e.exports=class{constructor(e,t){void 0===e&&(e="#termynal"),void 0===t&&(t={}),this.container="string"==typeof e?document.querySelector(e):e,this.pfx="data-"+(t.prefix||"ty"),this.startDelay=t.startDelay||parseFloat(this.container.getAttribute(this.pfx+"-startDelay"))||600,this.typeDelay=t.typeDelay||parseFloat(this.container.getAttribute(this.pfx+"-typeDelay"))||90,this.lineDelay=t.lineDelay||parseFloat(this.container.getAttribute(this.pfx+"-lineDelay"))||1500,this.progressLength=t.progressLength||parseFloat(this.container.getAttribute(this.pfx+"-progressLength"))||40,this.progressChar=t.progressChar||this.container.getAttribute(this.pfx+"-progressChar")||"\u2588",this.progressPercent=t.progressPercent||parseFloat(this.container.getAttribute(this.pfx+"-progressPercent"))||100,this.color=t.color||this.container.getAttribute(this.pfx+"-color")||"white",this.cursor=t.cursor||this.container.getAttribute(this.pfx+"-cursor")||"\u258b",this.lineData=this.lineDataToElements(t.lineData||[]),t.noInit||this.init(),this.isRunning=!1}init(){this.lines=[...this.container.querySelectorAll("["+this.pfx+"]")].concat(this.lineData);const e=getComputedStyle(this.container);this.container.style.width="0px"!==e.width?e.width:void 0,this.container.style.minHeight="0px"!==e.height?e.height:void 0,this.container.setAttribute("data-termynal",""),this.container.innerHTML=""}async start(){await this._wait(this.startDelay),this.isRunning=!0;for(let e of this.lines){const t=e.getAttribute(this.pfx),n=e.getAttribute(this.pfx+"-delay")||this.lineDelay;"input"===t?(e.setAttribute(this.pfx+"-cursor",this.cursor),await this.type(e),await this._wait(n)):"progress"===t?(await this.progress(e),await this._wait(n)):(this.container.appendChild(e),await this._wait(n)),e.removeAttribute(this.pfx+"-cursor")}}async type(e){const t=[...e.textContent],n=e.getAttribute(this.pfx+"-typeDelay")||this.typeDelay;e.textContent="",this.container.appendChild(e);for(let a of t)await this._wait(n),e.textContent+=a}async progress(e){const t=e.getAttribute(this.pfx+"-progressLength")||this.progressLength,n=(e.getAttribute(this.pfx+"-progressChar")||this.progressChar).repeat(t),a=e.getAttribute(this.pfx+"-progressPercent")||this.progressPercent;e.textContent="",this.container.appendChild(e);for(let o=1;o<n.length+1;o++){await this._wait(this.typeDelay);const t=Math.round(o/n.length*100);if(e.textContent=n.slice(0,o)+" "+t+"%",t>a)break}}_wait(e){return new Promise((t=>setTimeout(t,e)))}lineDataToElements(e){return e.map((e=>{let t=document.createElement("div");return t.innerHTML="<span "+this._attributes(e)+' style="color: '+e.color+'">'+(e.value||"")+"</span>",t.firstElementChild}))}_attributes(e){let t="";for(let n in e)t+=this.pfx,"type"===n?t+='="'+e[n]+'" ':"value"!==n&&(t+="-"+n+'="'+e[n]+'" ');return t}}}}]);